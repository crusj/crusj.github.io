---
layout: post
title: golang http中间件(middleware)
category: golang
---

**个人理解** golang中http中间件为一个请求链中的一环,用来对真正的请求处理进行一些预处理、如权限验证,参数处理或者辅助
进行日志记录等操作,与真正的业务处理分离。

---
实现一个demo中间件，验证请求来源ip,让某个ip无法访问网站

---

## golang http包接口分析
```
package http 

type Handler Interface{
   ServeHTTP(ResponseWriter, *Request)
}

type HandlerFunc func(ResponseWriter, *Request)

func (f HandlerFunc) ServeHTTP(w ResponseWriter,r *Request) {
    f(w, r)
}
```

* 以上为http库内置的http处理接口,其中Handler接口有一个ServeHttp接口函数，在处理请求的时候，会调用此函数
对接口进行处理。
*  任何实现了次接口的类型都可以作为http.ListenAndServe(string, Handler)中的第二个Handler类型参数进行
请求处理。
* 以上代码中HandlerFunc 就是包内置的默认的实现Handler接口的一种方式。也可以自定义。

### 自定义Handler,不使用http包内的HandlerFunc

```
type MyHandler struct {
    
}

func (mh *MyHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
    //do something
    
    // return result
    w.String(200, "hello world")
}

func main() {
    http.ListenAndServe(":1234",&MyHandler{})
}

```






